# テキスト類似度ベースdebounce機能の実装

## 背景

- **現状の課題**：
  - エージェントがMCPサーバーにテキストを送る際に、指示に反して勝手に内容を加工することがある
  - 現在のdebounce機能は**完全一致**のテキストのみ検出するため、わずかな変更があると重複投稿を許してしまう
  - 結果として、同じような内容の投稿が短時間に複数回行われる問題が発生している

- **ユーザー体験の問題**：
  - エージェントの自動テキスト加工により、意図せず似たような内容の投稿が複数回行われる
  - 現状の厳格なdebounceチェックではこの問題を解決できていない

## 修正の方向性

- **類似度ベースのdebounce機能**：
  - 編集距離（レーベンシュタイン距離）を使用したテキスト類似度の計算導入
  - 90%以上の類似度を持つテキストを同一と見なす閾値の設定
  - 短時間内の類似テキスト投稿をブロックする機能

## 考慮すべき点

1. **設定の柔軟性**：
   - 類似度の閾値（90%など）を設定可能にする
   - debounceの時間間隔も調整できるようにする

2. **パフォーマンス**：
   - レーベンシュタイン距離の計算は計算量が多い（O(n*m)）
   - 長文テキストや多数の投稿の場合、最適化が必要になる可能性

3. **システムリソース**：
   - 過去テキストの保存と比較による影響（メモリ使用量など）
   - 古いエントリの効率的な管理とクリーンアップ

4. **バランス**：
   - 厳しすぎる類似度検出で正当な投稿をブロックしない
   - 緩すぎる検出で重複投稿を許さない

5. **実装の現代化**：
   - Go 1.21以降の標準ライブラリ機能（min/max関数など）の活用
   - テスト容易性の確保

## 期待される効果

- エージェントのテキスト加工に影響されない安定した投稿処理
- 重複コンテンツの削減によるシステムとユーザー体験の改善
- 設定の柔軟性による様々なユースケースへの対応