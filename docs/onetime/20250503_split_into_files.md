# Goプロジェクトのファイル分割とレイアウトパターン

## 一般的なGoプロジェクトレイアウトパターン

### 1. フラットレイアウト

```
times_esa_mcp_server/
├── main.go        # mainとサーバー設定
├── models.go      # 構造体定義
├── esa_api.go     # esa.io APIとの連携関数
├── handlers.go    # リクエストハンドラー
├── utils.go       # ユーティリティ関数
├── go.mod
└── go.sum
```

**メリット**:
- シンプルで直感的
- ディレクトリ階層が浅く管理が容易
- 小〜中規模プロジェクトに最適
- インポートサイクルの問題が起きにくい

**デメリット**:
- プロジェクト成長時に管理が難しくなる
- 各ファイルが大きくなりすぎる可能性

### 2. 標準Goプロジェクトレイアウト

```
times_esa_mcp_server/
├── cmd/
│   └── server/
│       └── main.go    # エントリーポイント
├── internal/
│   ├── api/
│   │   └── esa.go     # esa.io API操作
│   ├── models/
│   │   └── models.go  # 構造体定義
│   ├── handlers/
│   │   └── reports.go # リクエストハンドラー
│   └── utils/
│       └── utils.go   # ユーティリティ関数
├── go.mod
└── go.sum
```

**メリット**:
- 大規模プロジェクトに適した組織化
- 責任の明確な分離
- `internal/`パッケージは外部からインポートできない
- テスト性の向上

**デメリット**:
- 小規模アプリケーションには複雑すぎる
- インポートサイクル回避に注意が必要

### 3. ドメイン駆動レイアウト

```
times_esa_mcp_server/
├── cmd/
│   └── server/
│       └── main.go    # エントリーポイント
├── internal/
│   ├── dailyreport/   # 日報関連機能
│   │   ├── models.go
│   │   ├── api.go
│   │   └── handler.go
│   ├── esa/           # esa.io特有機能
│   │   ├── client.go
│   │   └── models.go
│   └── common/        # 共通ユーティリティ
└── go.mod
```

**メリット**:
- ドメイン特化アプリケーションに適している
- 関連機能がグループ化される
- ビジネスロジックの理解が容易

**デメリット**:
- ドメイン間で重複が発生する可能性
- 単純なアプリケーションには過剰

## おすすめの分割方法

現在のコードサイズと機能を考慮すると、**フラットレイアウト**から始めることをお勧めします。以下のように分割するとよいでしょう：

1. **main.go** - `main()`関数とサーバーセットアップのみ
2. **models.go** - 構造体定義（EsaConfig、EsaPostなど）
3. **esa_client.go** - esa.io APIとやり取りする関数
4. **handlers.go** - `submitDailyReport`ハンドラー関数
5. **utils.go** - ユーティリティ関数（isDebounced, stripPrefixなど）

将来的にプロジェクトが成長した場合は、標準レイアウトへの移行も検討できます。初期段階ではフラットレイアウトでテスト性と可読性を向上させることが最も効果的です。
